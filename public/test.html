<html>
  <head>
    <title>Test</title>
    <script
      type="module"
      src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app.js"
    ></script>
    <script
      type="module"
      src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth.js"
    ></script>
  </head>
  <body>
    <h1>Test</h1>
    <button id="in">Sign In</button>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
      import {
        getAuth,
        GoogleAuthProvider,
        signInWithPopup,
      } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";

      //   window.onload = () => {
      //     const firebaseConfig = {
      //       apiKey: "AIzaSyAWnu968h4nq7gkvheuTx4ZiaFsxj74xJc",
      //       authDomain: "spoton-campus.firebaseapp.com",
      //       projectId: "spoton-campus",
      //       storageBucket: "spoton-campus.appspot.com",
      //       messagingSenderId: "975516839273",
      //       appId: "1:975516839273:web:6694ab0137b2d4548821f8",
      //       measurementId: "G-E2Y0ERJYXV",
      //     };

      //     const app = initializeApp(firebaseConfig);
      //     console.log(app);
      //   };

      function signIn() {
        const firebaseConfig = {
          apiKey: "AIzaSyAQ80_gyA2-s5lq0oE5-Qt314vmalMZwfk",
          authDomain: "spoton-campus.firebaseapp.com",
          projectId: "spoton-campus",
          storageBucket: "spoton-campus.appspot.com",
          messagingSenderId: "975516839273",
          appId: "1:975516839273:web:eeccb3f1ea4fcb338821f8",
          measurementId: "G-D4JJLE0STZ",
        };

        initializeApp({
          apiKey: "AIzaSyAQ80_gyA2-s5lq0oE5-Qt314vmalMZwfk",
          authDomain: "spoton-campus.firebaseapp.com",
          projectId: "spoton-campus",
          storageBucket: "spoton-campus.appspot.com",
          messagingSenderId: "975516839273",
          appId: "1:975516839273:web:eeccb3f1ea4fcb338821f8",
          measurementId: "G-D4JJLE0STZ",
        });

        const auth = getAuth();
        var provider = new GoogleAuthProvider();

        signInWithPopup(auth, provider)
          .then((result) => {
            // This gives you a Google Access Token. You can use it to access the Google API.
            const credential = GoogleAuthProvider.credentialFromResult(result);
            const token = credential.accessToken;
            // The signed-in user info.
            const user = result.user;
            // IdP data available using getAdditionalUserInfo(result)
            // ...
            if (user) {
              console.log("User is signed in.");
              console.log(user);

              fetch("/auth/login", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  accessToken: user.accessToken,
                }),
              })
                .then((res) => res.json())
                .then((data) => {
                  console.log(data);
                });
            } else {
              console.log("No user is signed in.");
            }
          })
          .catch((error) => {
            // Handle Errors here.
            const errorCode = error.code;
            const errorMessage = error.message;
            // The email of the user's account used.
            const email = error.customData.email;
            // The AuthCredential type that was used.
            console.log(error);
            const credential = GoogleAuthProvider.credentialFromError(error);
            // ...
          });
      }

      document.getElementById("in").addEventListener("click", signIn, false);
    </script>
  </body>
</html>
